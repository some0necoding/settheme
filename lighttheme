#!/bin/bash
#
# --------------- lighttheme ---------------
#
# This script can be used both to manually
# set kde desktop theme to breeze (light) or 
# to specify the time when it will be set
# automatically.
#

TIMINGS="/home/${USER}/.local/share/settheme/timings"

mkfile() {

	FILENAME=$(echo $1 | grep -oE "[a-zA-Z_\-\.]*$")
	FOLDER=${1%$FILENAME}

	mkdir -p "$FOLDER"
	touch "$1"
}

if [ -z "$1" ]; then
	lookandfeeltool -a 'org.kde.breeze.desktop' &> /dev/null
elif [ -n "$1" -a -n "$2" ]; then

	# Check argument
	[[ $1 -ne set ]] && echo "invalid command: $1"; exit 0

	# Check good date format
	[[ $2 =~ "^[0-9]{2}:[0-9][2]:[0-9][2]$" ]] || echo "$2 is not a valid date format. Use instead HH:MM:SS"; exit 0

	# Check if timings file exists. If not, create it.
	[[ -e $TIMINGS ]] || mkfile $TIMINGS

	# Convert date in HH:MM:SS format into seconds
	TIME=$(date -d"$2" +%s)

	# If inserted date is equal to darktheme date, throw an error
	[[ $TIME -ne $D_TIME ]] || echo "lighttheme activation time cannot be the same as darktheme"; exit 0

	# else set L_TIME to the inserted date
	sed -i 's/L_TIME=[0-9]*/L_TIME=${TIME}/g' $TIMINGS

fi
